---
title: "Data Science for Economists"
# subtitle: "<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>"
subtitle: "ECON 370 Final Project - predicting next months S&P500 return"
author: "August Valdemar Bering Nielsen"
date: "University of North Carolina | [ECON 370](https://github.com/JiaxiLi1995/ECON370)" #"`r format(Sys.time(), '%d %B %Y')`"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts] 
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(knitr)
opts_chunk$set(
  fig.align="center", 
  fig.height=5, fig.width=10, 
  # out.width="748px", #out.length="520.75px",
  dpi=300, #fig.path='Figs/',
  cache=F, echo=F, warning=F, message=F
  )
library(fontawesome)
library(microbenchmark)
library(dplyr)
library(tidyr)
library(ggplot2)
set.seed(123)

# This function is used to color text
color_text <- function(text, color){
  if (knitr::is_html_output()) {
    paste0('<span style="color:', color, '">', text, '</span>')
  } else {
    paste0('\\textcolor{', color, '}{', text, '}')
  }
}
```

# Introduction

The goal of this project was to develop a predictive model from start to finish, by collecting data, using different models and evaluating the performance. 

**Hightlight of the project**:
- Data: 7 Macroeconomic & Monetary Conditions variables, 4 Sentiment & Uncertainty Indicators, 4 Financial Markets & Risk Indicators and 2 Nontraditional / Commodity indicators. 
- Model: *Linear Model* as benchmark and *LASSO model* as the advanced model
- Summary: With the more complex model, I am able to move the predictive $R^2$ from `r color_text("-0.287", "blue")` to `r color_text("0.043", "red")`. Using my LASSO trading strategy of buying when LASSO was positive, I was able to boost the overall return in the period from ~3% to ~6.8%, where the ~3% return refers to the Linear Model Strategy. However, I was not able to beat the simple buy and hold strategy. 

---
# Data
My variables include
- Business confidence indicator (BSCICP02USM460S)
- Consumer sentiment confidence indicator (CSINFT02USM460S)
- University of Michigan: Consumer Sentiment (UMCSENT) 
- Economic policy uncertainty index (EMVOVERALLEMV)
- Unemployment rate (UNRATENSA) 
- Real-time Sahm Rule Recession Indicator (SAHMREALTIME)
- CPI (month-over-month change)
- Federal Funds Effective Rate and the Prime Rate
- 10-Year Treasury Constant Maturity - 3-Month Treasury Constant Maturity (T10Y3MM) 
- Fama-French factors, SMB, HML and Market Excess Return
- Spot Crude Oil Price (WTISPLC)
- Monthly Supply of New Houses in the United States (MSACSR) 
- Chicago Fed National Activity Index (CFNAI)
- Average Price: Eggs, Grade A, Large (Cost per Dozen) in U.S. City Average

An important and interesting variable is the 10-year Treasury Bond minus the 3-year Treasury Bond, the Yield Spread, because historically, an inverted yield curve is a strong signal of economic recession.

---
# Model

Beyond the linear model, I also used a LASSO model for the analysis.

LASSO is a penalized regression method that can shrink coefficients and set some to zero, to help prevent overfitting. The tuning parameter 
$\lambda$ controls how strong this shrinkage is, and $\alpha=1$ specifies that the model uses the LASSO (L1) penalty.

For the LASSO model, I have the division as:

1985-2000 as training, 2001-2008 as validation, and 2009 to evaluate the model

1985-2001 as training, 2002-2009 as validation, and 2010 to evaluate the model

â€¦

1985-2015 as training, 2016-2023 as validation, and 2024 to evaluate the model

---
# Main Result

Both models are quite bad. Even with 17 variables we have very low predictability and mostly just noise. Monthly stock returns behave very close to a random walk in a Markov chain.

```{r, message = F}
library(ggplot2)
# Put your mouse on "Raw" and right click, then "copy link address"
Testing_result <- readRDS(url("https://github.com/AugustVBNielsenUNCUCPH/ECON370.FINAL.PROJECT.AUGUST-NIELSEN.RAW.DATA/raw/refs/heads/main/Testing_result.rds"))

# calculate OOS r squared
# Create a function to estimate R_Sq_oos
R_Sq_oos_func = function(actual_return, fitted_return) {
  return(1 - sum((actual_return - fitted_return)^2)/sum((actual_return)^2))
}

# Print the OOS R^2 result
print(
  paste(
    "The OOS R^2 for the OLS is: ",
    R_Sq_oos_func(Testing_result$actual_return, Testing_result$fitted_return_OLS)
  )
)

print(
  paste(
    "The OOS R^2 for the LASSO is: ",
    R_Sq_oos_func(Testing_result$actual_return, Testing_result$fitted_return_Complex)
  )
)

# Plot the result
ggplot(Testing_result) +
  geom_point(aes(actual_return, actual_return - fitted_return_OLS, color = "OLS")) +
  # Change your method name here
  geom_point(aes(actual_return, actual_return - fitted_return_Complex, color = "LASSO")) +
  # Fitted regression line 
  geom_smooth(aes(actual_return, actual_return - fitted_return_OLS, color = "OLS"),
              method = "lm", se = TRUE) +
  geom_smooth(aes(actual_return, actual_return - fitted_return_Complex, color = "LASSO"),
              method = "lm", se = TRUE) +
  labs(y = "Residual",
      x = "Actual Return")
```



---
# Trading Strategies

The performance of the LASSO model is better than the linear model. We would expect that our *buy-LASSO-positive* return is lower than our simple *buy-and-hold* return around 2023, because we have a negative $R^2$ value in this year. Since our model has worse predictability than simply buying and holding the S&P500 in this period, the buy-and-hold benchmark outperforms the LASSO model, as we can see by the red line.

```{r}
Trading_Strategy <- readRDS(url("https://github.com/AugustVBNielsenUNCUCPH/ECON370.FINAL.PROJECT.AUGUST-NIELSEN.RAW.DATA/raw/refs/heads/main/Trading_Strategy.rds"))

Trading_Strategy |>
  pivot_longer(c(buyLMpositive, buyLASSOpositive, buyANDhold), names_to = "Strategy", values_to = "CR") |>
  ggplot(aes(predicting_date, CR, color = Strategy)) +
  geom_line(linewidth = 1) +
  theme_minimal() +
  labs(
    title = "Cumulative Returns with Different Trading Strategies",
    x = "Date",
    y = "Cumulative Returns",
    color = "Trading Stategy"
  ) +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5)  # <-- Center the title
  )
```

---

class: inverse, center, middle


### Thank you for your time.


<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>


```{r gen_pdf, include = FALSE, cache = FALSE, eval = TRUE}
# After getting the html, run the code below
# # Here should be the correct html file name
# infile = "Example_presentation.html"
# pagedown::chrome_print(input = infile, timeout = 1000)
```
